# 更新日志

## v2.1.1 (2025-12-22)

### 🎊 新增功能

- **五一劳动节**：新增劳动节到法定节假日列表，自动显示倒计时

### 🐛 问题修复

- 修复添加劳动节后卡片样式错位问题，调整 CSS 选择器适配 7 个节日
- 修复国庆节五角星装饰不显示的问题，改用模糊匹配节假日名称

### 🎨 样式优化

- 为劳动节卡片设计粉紫色渐变配色
- 确保国庆节五角星在所有情况下正常显示

---

## v2.1.0 (2025-12-12)

### 🎉 新增功能

#### 下班礼花庆祝
- **自动触发**：下班时刻自动放礼花，每日限触发一次
- **多屏全覆盖**：支持多显示器同时显示礼花效果
- **双击彩蛋**：双击下班倒计时卡片可手动触发礼花
- **可配置选项**：
  - 颜色方案：经典彩色、金色璀璨、梦幻紫色、彩虹渐变
  - 礼花强度：轻柔、适中、热烈
  - 全屏开关：可选择仅在当前窗口或全屏显示
- **测试功能**：设置页面提供"测试效果"按钮，预览当前配置

### 📁 新增文件

```
public/
└── confetti-window.html   # 礼花叠加窗口
src/
└── utils/
    └── confetti.ts        # 礼花核心工具模块
```

### 🔧 技术实现

- 使用 `canvas-confetti` 库实现礼花动画效果
- 通过 `utools.getAllDisplays()` 获取所有显示器信息
- 使用 `utools.createBrowserWindow()` 创建透明叠加窗口
- 扩展 `utools.ts` 添加屏幕和窗口 API 类型定义
- Store 新增 `confettiSettings` 状态持久化

### 📦 依赖变更

#### 新增
- `canvas-confetti` - 礼花动画效果库

---

## v2.0.1 (2025-12-12)

### 性能与架构优化

- 工时进度计算收敛到 store，`useWorkProgress` 仅做读取，避免重复计算。
- 节日/自定义倒计时改为按日刷新，减少每秒 map/sort 的无效开销。
- 节假日同步增加 24 小时节流、超时与重试，离线/超时提示更明确。
- uTools API 访问统一到 `utils/utools.ts`，降低页面耦合。
- 精简未使用的 dayjs 插件，缩小运行时体积。
- Vite `manualChunks` 分包，设置页与 ICS 解析懒加载，首屏包显著下降。

### Bug 修复

- 修复 ticker 清理判断在极端情况下可能失效的问题。

## v2.0.0 (2025-12-02)

### 🎯 新增功能

#### 工作进度可视化
- **进度条组件**：显示当日工作进度，直观展示"已完成/总时长"
- **颜色分段**：根据进度自动变色
  - 0-30%：红黄渐变（早期阶段）
  - 30-70%：蓝色渐变（平稳期）
  - 70-90%：绿色渐变（快结束了）
  - 90-100%：金色流光特效（冲刺阶段）
- **午休状态**：午休期间显示条纹暂停样式，进度计算自动扣除午休时间

#### 发薪日倒计时
- **发薪日卡片**：显示距离发薪日天数，临近时高亮提醒
- **智能计算**：自动识别下一个发薪日，当月已过则指向下月
- **节假日调整**：支持四种规则
  - 顺延：遇休息日往后顺延
  - 提前：遇休息日往前提前
  - 就近：优先调整到周五
  - 不调整：按原日期显示
- **短月适配**：设置 31 号时自动适配 2 月等短月

#### 摸鱼模式
- **隐蔽时钟**：等宽字体代码风格，伪装成日志输出
- **极简黑白**：移除所有彩色背景、渐变和 Emoji
- **快速切换**：
  - 点击眼睛图标切换
  - 双击空白区域快速切换（更隐蔽）

#### 周五狂欢
- 周五自动切换限定皮肤（霓虹渐变配色）
- 文案变为"周五限定：坚持住！"
- 图标变为庆祝 emoji 🎉

### 🔧 架构优化

#### UI 框架策略
- **展示页**：保持原生 CSS + Flex/Grid 布局，性能优先
- **设置页**：全面接入 Naive UI 组件，提升表单交互体验
  - `n-time-picker`：时间选择
  - `n-input-number`：数字输入
  - `n-switch`：开关切换
  - `n-select`：下拉选择
  - `n-date-picker`：日期选择

#### 数据结构升级
- 新增 `LunchBreakSetting`：午休设置（启用状态、开始/结束时间）
- 新增 `SalarySettings`：发薪日设置（日期、节假日处理规则）
- 新增 `DisplaySettings`：显示偏好（秒数显示、模式切换）

#### 代码重构
- 抽取 `useWorkProgress` Hook：封装工作进度计算逻辑
- 抽取 `usePayday` Hook：封装发薪日计算逻辑
- 抽取公共函数到 `utils/time.ts`：
  - `formatDuration`：完整时长格式化（含秒）
  - `formatCompactDuration`：紧凑时长格式化（不含秒）

### 🐛 Bug 修复

- 修复工作日查找循环逻辑错误
- 修复节假日调休上班日判断不准确的问题
- 修复展示页 `currentTime` 响应式丢失问题
- 修复设置页 DatePicker 空值导致页面空白的问题
- 修复进度条右侧溢出容器的问题
- 优化进度条圆角样式（胶囊形改为圆角矩形）
- 优化摸鱼模式切换图标的视觉效果和悬停交互

### 📁 新增文件

```
src/
├── components/
│   ├── ProgressBar.vue    # 进度条组件
│   ├── PaydayCard.vue     # 发薪日卡片
│   └── StealthClock.vue   # 摸鱼模式时钟
├── hooks/
│   ├── useWorkProgress.ts # 工作进度 Hook
│   └── usePayday.ts       # 发薪日 Hook
└── utils/
    └── workSession.ts     # 工作时段计算工具
```

### 📦 依赖变更

#### 新增
- `naive-ui` - Vue 3 UI 组件库
- `unplugin-vue-components` - 组件按需引入插件

---

## v1.0.0

- 初始版本
- 基础倒计时功能
- 节假日数据同步
- 自定义倒计时
